#!/bin/env bash

set -e

: ${SHM_STORE:=~/.shm}
: ${EDITOR:=vi}

if which tree >/dev/null 2>&1;
then
    LIST="tree --noreport --prune --"
else
    LIST=find
fi

if pygmentize -l md </dev/null >/dev/null 2>&1;
then
    CAT="pygmentize -l md"
else
    CAT=cat
fi

if [[ -z "${1}" ]];
then
    mkdir -p ${SHM_STORE}
    ${LIST} ${SHM_STORE}
    echo
    exit
fi

case ${1} in
    "add" | "edit" ) 
        mkdir -p $(dirname ${SHM_STORE}/${2})
        ${EDITOR} ${SHM_STORE}/${2}
        ;;
    "search" | "find" )
        find ${SHM_STORE} -name "*${2}*"
        ;;
    "rm" ) 
        rm ${SHM_STORE}/${2}
        ;;
    "mv" )
        mv ${SHM_STORE}/${2} ${SHM_STORE}/${3}
        ;;
    "cp" )
        cp ${SHM_STORE}/${2} ${SHM_STORE}/${3}
        ;;
    *) ${CAT} ${SHM_STORE}/${1};;
esac
